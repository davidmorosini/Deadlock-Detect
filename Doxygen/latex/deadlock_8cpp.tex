\hypertarget{deadlock_8cpp}{}\section{Referência do Arquivo C\+:/\+Users/david/\+Desktop/\+Trabalho S\+O/final/deadlock.cpp}
\label{deadlock_8cpp}\index{C\+:/\+Users/david/\+Desktop/\+Trabalho S\+O/final/deadlock.\+cpp@{C\+:/\+Users/david/\+Desktop/\+Trabalho S\+O/final/deadlock.\+cpp}}
{\ttfamily \#include \char`\"{}globais.\+h\char`\"{}}\newline
\subsection*{Funções}
\begin{DoxyCompactItemize}
\item 
\hyperlink{globais_8h_a2e359a3fb9af53f8434ff04826599fa3}{matriz} \hyperlink{deadlock_8cpp_ac3db7ba6cb5588e924c6ce3fab2ef9e7}{aloca\+\_\+matriz} (int l, int c)
\begin{DoxyCompactList}\small\item\em Função alocar espaço de memória para um vector$<$vector$<$int$>$ $>$ trabalhando assim com uma matriz diâmica. \end{DoxyCompactList}\item 
\hyperlink{globais_8h_a2e359a3fb9af53f8434ff04826599fa3}{matriz} \hyperlink{deadlock_8cpp_acc0051a8d138dce5386f0a7bf7e5e8d3}{cria\+\_\+matriz\+\_\+deteccao} (vector$<$ \hyperlink{globais_8h_a15fcba6ac1df7611be8b80db7e5d21e8}{leitor} $>$ threads, unsigned int qdt\+\_\+recursos, \hyperlink{globais_8h_a2e359a3fb9af53f8434ff04826599fa3}{matriz} $\ast$indices)
\begin{DoxyCompactList}\small\item\em Função para criar a matriz de detecção do deadlock. \end{DoxyCompactList}\item 
\hyperlink{globais_8h_a2e359a3fb9af53f8434ff04826599fa3}{matriz} \hyperlink{deadlock_8cpp_a492e84ee7d6ab4119a9b7ba1b54961ef}{elimina\+\_\+ruidos} (\hyperlink{globais_8h_a2e359a3fb9af53f8434ff04826599fa3}{matriz} m, vector$<$ int $>$ rec)
\begin{DoxyCompactList}\small\item\em Função eliminar todas as threads e recursos que nao interferem no possível deadlock. \end{DoxyCompactList}\item 
vector$<$ \hyperlink{globais_8h_aa04ac57ceac49fac27ba22c766b76972}{pt} $>$ \hyperlink{deadlock_8cpp_a730ef18d7bdb82d373bb891f0272c413}{detecta\+\_\+deadlock} (\hyperlink{globais_8h_a2e359a3fb9af53f8434ff04826599fa3}{matriz} m, int x, int y, int qtd)
\begin{DoxyCompactList}\small\item\em Função detectar o deadlock de uma matriz de detecção. \end{DoxyCompactList}\item 
vector$<$ \hyperlink{globais_8h_aa04ac57ceac49fac27ba22c766b76972}{pt} $>$ \hyperlink{deadlock_8cpp_ae290c0afc3bdcd5c3ddce1921889d310}{percorre\+\_\+matriz} (vector$<$ \hyperlink{globais_8h_a15fcba6ac1df7611be8b80db7e5d21e8}{leitor} $>$ threads, vector$<$ int $>$ rec, \hyperlink{globais_8h_a2e359a3fb9af53f8434ff04826599fa3}{matriz} $\ast$indices)
\begin{DoxyCompactList}\small\item\em Função percorrer a matriz de detecção buscando possiveis ciclos a partir de cada posicção cuja houver requisição de recurso. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Funções}
\mbox{\Hypertarget{deadlock_8cpp_ac3db7ba6cb5588e924c6ce3fab2ef9e7}\label{deadlock_8cpp_ac3db7ba6cb5588e924c6ce3fab2ef9e7}} 
\index{deadlock.\+cpp@{deadlock.\+cpp}!aloca\+\_\+matriz@{aloca\+\_\+matriz}}
\index{aloca\+\_\+matriz@{aloca\+\_\+matriz}!deadlock.\+cpp@{deadlock.\+cpp}}
\subsubsection{\texorpdfstring{aloca\+\_\+matriz()}{aloca\_matriz()}}
{\footnotesize\ttfamily \hyperlink{globais_8h_a2e359a3fb9af53f8434ff04826599fa3}{matriz} aloca\+\_\+matriz (\begin{DoxyParamCaption}\item[{int}]{l,  }\item[{int}]{c }\end{DoxyParamCaption})}



Função alocar espaço de memória para um vector$<$vector$<$int$>$ $>$ trabalhando assim com uma matriz diâmica. 

\hyperlink{deadlock_8cpp}{deadlock.\+cpp}

Arquivo com funções relacionadas a identificação dos possiveis deadlocks

\begin{DoxyDate}{Data}
05.\+07.\+2017 
\end{DoxyDate}
\begin{DoxyAuthor}{Autores}
Caio Vianna, David Morosini
\end{DoxyAuthor}

\begin{DoxyParams}{Parâmetros}
{\em int} & l\+: quantidade de linhas da matriz. \\
\hline
{\em int} & c\+: quantidade de colunas da matriz. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Retorna}
matriz\+: uma estrutura de dados matriz alocada. 
\end{DoxyReturn}
\mbox{\Hypertarget{deadlock_8cpp_acc0051a8d138dce5386f0a7bf7e5e8d3}\label{deadlock_8cpp_acc0051a8d138dce5386f0a7bf7e5e8d3}} 
\index{deadlock.\+cpp@{deadlock.\+cpp}!cria\+\_\+matriz\+\_\+deteccao@{cria\+\_\+matriz\+\_\+deteccao}}
\index{cria\+\_\+matriz\+\_\+deteccao@{cria\+\_\+matriz\+\_\+deteccao}!deadlock.\+cpp@{deadlock.\+cpp}}
\subsubsection{\texorpdfstring{cria\+\_\+matriz\+\_\+deteccao()}{cria\_matriz\_deteccao()}}
{\footnotesize\ttfamily \hyperlink{globais_8h_a2e359a3fb9af53f8434ff04826599fa3}{matriz} cria\+\_\+matriz\+\_\+deteccao (\begin{DoxyParamCaption}\item[{vector$<$ \hyperlink{globais_8h_a15fcba6ac1df7611be8b80db7e5d21e8}{leitor} $>$}]{threads,  }\item[{unsigned int}]{qdt\+\_\+recursos,  }\item[{\hyperlink{globais_8h_a2e359a3fb9af53f8434ff04826599fa3}{matriz} $\ast$}]{indices }\end{DoxyParamCaption})}



Função para criar a matriz de detecção do deadlock. 


\begin{DoxyParams}{Parâmetros}
{\em vector$<$leitor} & $>$ threads\+: vector de estruturas de dados leitor (verificar em \hyperlink{globais_8h}{globais.\+h}) \\
\hline
{\em unsigned} & int qdt\+\_\+recursos\+: quantidade de recursos (semáforos) existentes. \\
\hline
{\em matriz} & $\ast$ indices\+: forma de retorno para uma matriz que mapeia os indices dos comandos P\textquotesingle{}s solicitados. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Retorna}
matriz\+: uma estrutura de dados matriz alocada na forma da matriz de detecção. 
\end{DoxyReturn}
Criação da matriz conta a disposição dos recursos e processos como uma matriz de adjacências Matriz n x m, onde\+: n = Quantidade de Threads + Quantidade de recursos m = Quantidade de Threads + Quantidade de recursos

A matriz de indices é criada com o mesmo tamanho, porém o conteúdo se difere, ja que é composta pelos indices dos P\textquotesingle{}s da matriz de adjacencias criada

A idéia principal por traz da matriz de detecção é mapear todos os pedidos de recurso até um dado momento de forma a verificar se neste conjunto de requisições há a possibilidade de deadlock, por isso mapeamos na mesma a quantidade de requisições de cada recurso que cada thread solicitou. Na matriz de indices salvamos apenas qual a ordem desta solicitação na execução da sua thread.

Indices é um ponteiro somente para retorno dos dados\mbox{\Hypertarget{deadlock_8cpp_a730ef18d7bdb82d373bb891f0272c413}\label{deadlock_8cpp_a730ef18d7bdb82d373bb891f0272c413}} 
\index{deadlock.\+cpp@{deadlock.\+cpp}!detecta\+\_\+deadlock@{detecta\+\_\+deadlock}}
\index{detecta\+\_\+deadlock@{detecta\+\_\+deadlock}!deadlock.\+cpp@{deadlock.\+cpp}}
\subsubsection{\texorpdfstring{detecta\+\_\+deadlock()}{detecta\_deadlock()}}
{\footnotesize\ttfamily vector$<$\hyperlink{globais_8h_aa04ac57ceac49fac27ba22c766b76972}{pt}$>$ detecta\+\_\+deadlock (\begin{DoxyParamCaption}\item[{\hyperlink{globais_8h_a2e359a3fb9af53f8434ff04826599fa3}{matriz}}]{m,  }\item[{int}]{x,  }\item[{int}]{y,  }\item[{int}]{qtd }\end{DoxyParamCaption})}



Função detectar o deadlock de uma matriz de detecção. 


\begin{DoxyParams}{Parâmetros}
{\em matriz} & m\+: matriz de detecção ja criada \\
\hline
{\em int} & x\+: posição x da matriz onde sera iniciada a verificação \\
\hline
{\em int} & y\+: posição y da matriz onde sera iniciada a verificação \\
\hline
{\em int} & qtd\+: quantidade de recursos requisitados no bloco atual de requisições \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Retorna}
vector$<$pt$>$\+: vector da estrutura de dados \hyperlink{struct_ponto}{Ponto}, contendo a possivel sequencia de deadlock 
\end{DoxyReturn}
Partindo desde ponto, sera executado uma busca de ciclos em grafos

Uma das condições de permanencia do While é o contador ser menor que qtd -\/1 pois, qtd representa a quantidade de recursos requeridos, entao so faz sentido procurar um ciclo de no maximo este tamanho

Caso tenha solicitação do recurso atual, e caso ele não mapeie novamente no mesmo recurso (representação da matriz de detecção, alguns pontos remapeiam)

Condição esta que me diz que este caminho não forma um ciclo, sendo necessário voltar e tentar outro Representado por\+: seq\+\_\+deadlock.\+back().y + 1, que é o comando anterior, acrescido de um para continuar a execução\mbox{\Hypertarget{deadlock_8cpp_a492e84ee7d6ab4119a9b7ba1b54961ef}\label{deadlock_8cpp_a492e84ee7d6ab4119a9b7ba1b54961ef}} 
\index{deadlock.\+cpp@{deadlock.\+cpp}!elimina\+\_\+ruidos@{elimina\+\_\+ruidos}}
\index{elimina\+\_\+ruidos@{elimina\+\_\+ruidos}!deadlock.\+cpp@{deadlock.\+cpp}}
\subsubsection{\texorpdfstring{elimina\+\_\+ruidos()}{elimina\_ruidos()}}
{\footnotesize\ttfamily \hyperlink{globais_8h_a2e359a3fb9af53f8434ff04826599fa3}{matriz} elimina\+\_\+ruidos (\begin{DoxyParamCaption}\item[{\hyperlink{globais_8h_a2e359a3fb9af53f8434ff04826599fa3}{matriz}}]{m,  }\item[{vector$<$ int $>$}]{rec }\end{DoxyParamCaption})}



Função eliminar todas as threads e recursos que nao interferem no possível deadlock. 


\begin{DoxyParams}{Parâmetros}
{\em matriz} & m\+: matriz de detecção ja criada \\
\hline
{\em vector$<$int$>$} & rec\+: vector de recursos \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Retorna}
matriz\+: matriz de detecção restando apenas as threads e recursos que de fato podem influenciar no deadlock 
\end{DoxyReturn}
i começa em qtd\+\_\+threads por causa do formato da matriz de detecção\+: as linhas de 0 a qtd\+\_\+threads representam as threads na horizontal as colunas de 0 a qtd\+\_\+threads representam as threads na vertical as demais posições representam os recursos \begin{DoxyVerb}    t0  t1 ... tn   r0  ... rm
\end{DoxyVerb}
 t0 t1 ... tn r0 ... rm

Aplicando a primira \char`\"{}poda\char`\"{}, de colunas\+: Se a soma de requisições de um dado recurso por todas as threads for menor ou igual a qantidade disponivel, significa que aquele recurso pode ser alocado para todos, logo não participa do possivel deadlock, caso exista.

Eliminação de colunas -\/$>$ consiste em zerar toda a coluna referente ao recurso que só possui uma requisição

Caso o somatório de requisições (coluna J, cada coluna representando um recurso) for menor ou igual a quantidade de recursos disponiveis (da mesma posicao J), zeramos a coluna J da matriz de detecção

Aplicando a segunda \char`\"{}\+Poda\char`\"{}, que consiste em\+: Se uma dada \hyperlink{struct_thread}{Thread} esta requisitando apenas um recurso, existindo apenas duas possibilidades\+: Cenário 1\+: Ela possui o recurso, mas como não esta solicitando nenhum outro e este estando em sua posse a mesma segue sua execução, terminando, libera o recurso para as demais. Cenário 2\+: Ela não possui o recurso, mas como não possui nenhum outro recurso em sua posse, esta espera não configura deadlock, podemos supor então que o conjunto de recursos esta alocado para as demais threads portando podemos refazer os calculos sem levar em conta esta thread, por ela não influenciar no deadlock caso exista.

Eliminação de linhas -\/$>$ consiste em zerar toda a linha referente a thread que só possui uma requisição

Caso o somatório de requisições (linha i, cada linha representando uma thread) for igual a 1 (um), zeramos a linha i da matriz de detecção

É feita a recontagem das colunas para que caso seja necessário, seja refeito o procedimento

Caso a quantidade de colunas cujo somatorio seje menor ou igual a quantidade deisponivel de recursos for maior que 1, significa que eu posso realizar a \char`\"{}poda\char`\"{} novamente.\mbox{\Hypertarget{deadlock_8cpp_ae290c0afc3bdcd5c3ddce1921889d310}\label{deadlock_8cpp_ae290c0afc3bdcd5c3ddce1921889d310}} 
\index{deadlock.\+cpp@{deadlock.\+cpp}!percorre\+\_\+matriz@{percorre\+\_\+matriz}}
\index{percorre\+\_\+matriz@{percorre\+\_\+matriz}!deadlock.\+cpp@{deadlock.\+cpp}}
\subsubsection{\texorpdfstring{percorre\+\_\+matriz()}{percorre\_matriz()}}
{\footnotesize\ttfamily vector$<$\hyperlink{globais_8h_aa04ac57ceac49fac27ba22c766b76972}{pt}$>$ percorre\+\_\+matriz (\begin{DoxyParamCaption}\item[{vector$<$ \hyperlink{globais_8h_a15fcba6ac1df7611be8b80db7e5d21e8}{leitor} $>$}]{threads,  }\item[{vector$<$ int $>$}]{rec,  }\item[{\hyperlink{globais_8h_a2e359a3fb9af53f8434ff04826599fa3}{matriz} $\ast$}]{indices }\end{DoxyParamCaption})}



Função percorrer a matriz de detecção buscando possiveis ciclos a partir de cada posicção cuja houver requisição de recurso. 


\begin{DoxyParams}{Parâmetros}
{\em vector$<$leitor$>$} & threads\+: vector da estrutura de dados \hyperlink{struct_leitor}{Leitor} \\
\hline
{\em vector$<$int$>$} & rec\+: vector de recursos \\
\hline
{\em matriz} & $\ast$ indices\+: forma de retorno para uma matriz que mapeia os indices dos comandos P\textquotesingle{}s solicitados. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Retorna}
vector$<$pt$>$\+: vector da estrutura de dados \hyperlink{struct_ponto}{Ponto}, contendo a possivel sequencia de deadlock 
\end{DoxyReturn}
a partir do vector de leitores, que representa o bloco de comoandos naquele dado momento cria se uma matriz de detecção, e logo após são retirados todos os ruídos pelo algoritmo de \char`\"{}poda\char`\"{}

É realizada a contagem de recursos solicitados

o bloco de comandos é percorrido para se testar os possiveis comandos que geram deadlock

coluna representa qual recurso estou verificando no momento, e caso ele seja mapeado na matriz de indices, que por sua vez mapeia todos os recursos solicitados, rode o algoritmo de detecção de deadlock, por que assim garante se que o comando existe, pode ocasionar deadlock e esta mapeado na matriz de indices

Caso o vector deadlock seja preenchido, significa que foi encontrado ciclo, podendo este ser de fato um deadlock